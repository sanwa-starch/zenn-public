---
title: "Ubuntu Server åˆæœŸè¨­å®šã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹"
emoji: "ğŸ˜º"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["ubuntu"]
published: true
published_at: 2023-05-18
---

å½“ç¤¾ã§ã¯é‹ç”¨ã‚µãƒ¼ãƒã« Ubuntu Server ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚
Ubuntu ã‚’é¸æŠã—ã¦ã„ã‚‹ç†ç”±ã¯ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã«æ–°ã—ã„çŸ¥è¦‹ãŒå¤šã„ã“ã¨ã‚„æ¬¡ã®ã‚ˆã†ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç®¡ç†ã®ã‚·ãƒ³ãƒ—ãƒ«ã•ã«ãƒ¡ãƒªãƒƒãƒˆã‚’æ„Ÿã˜ã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚
-root ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹
-`unattended-upgrade` ã«ã‚ˆã‚‹è‡ªå‹•ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
-ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ« (ufw) ã®æ‰±ã„ãŒã‚·ãƒ³ãƒ—ãƒ«

è¿‘å¹´ã§ã¯ä¼æ¥­ãŒã‚µã‚¤ãƒãƒ¼ãƒ†ãƒ­ã«ã‚ˆã‚Šæ¥­å‹™ã‚’å¦¨å®³ã•ã‚ŒãŸã‚Šã€ãƒ©ãƒ³ã‚µãƒ ã‚¦ã‚§ã‚¢ã‚„ãƒ¯ã‚¤ãƒ‘ãƒ¼ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿è¢«å®³ãŒæ€¥å¢—ã—ã¦ã„ã¾ã™ã€‚ãã®ã‚ˆã†ãªæ”»æ’ƒã«å¸¸ã«å¯¾æŠ—ã™ã‚‹ãŸã‚ã«ã¯ã€ç¤¾å¤–ã®ã¿ãªã‚‰ãšç¤¾å†…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚‚å±é™ºã¨ã„ã†è¦–ç‚¹ã§è„†å¼±æ€§ã‚’é˜²ãç¶šã‹ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚
ã—ã‹ã—ã€å¸¸ã«æ‰‹å‹•ã§ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’ç¶šã‘ã‚‹ã¨ã„ã†ã“ã¨ã¯ä¸¦å¤§æŠµã®ã“ã¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã®ã§ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®ç®¡ç†ã‚³ã‚¹ãƒˆã‚’å°‘ã—ã§ã‚‚ä¸‹ã’ã‚‰ã‚Œã‚‹ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¯éå¸¸ã«åŠ©ã‹ã‚Šã¾ã™ã­ï¼

ã“ã“ã§ã¯ã€å½“ç¤¾ãŒè¡Œã£ã¦ã„ã‚‹ Ubuntu Server ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã®æœ€ä½é™ã®è¨­å®šã«ã¤ã„ã¦ã€å…±æœ‰ã—ã¦ã„ãã¾ã™ã€‚
ã•ã‚‰ã«ã‚»ã‚­ãƒ¥ã‚¢ã§ã‚·ãƒ³ãƒ—ãƒ«ãªè¨­å®šãŒã‚ã‚Œã°ã€ãœã²ã‚³ãƒ¡ãƒ³ãƒˆãã ã•ã„ï¼


# å‰æ & ç’°å¢ƒ
Ubuntu Server ã¯ Minimal ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã§ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ OpenSSH ã‚’åŒæ™‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚
IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ `192.168.1.10` ã€ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ `hoge` ã¨ã—ã¦ã„ã¾ã™ã€‚
```sh:Ubuntu Server bash
$ lsb_release -a
No LSB modules are available.
Distributor ID: Ubuntu
Description:    Ubuntu 22.04.2 LTS
Release:        22.04
Codename:       jammy
```

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ Windows 11 ã¨ WSL2 (Ubuntu) ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚
```powershell:Windows / cmd
> ver
Microsoft Windows [Version 10.0.22000.1335]
> wsl -l -v
  NAME                   STATE           VERSION
* Ubuntu-22.04           Running         2
```

# SSH ã®è¨­å®š

### ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ç¢ºèª
Ubuntu Server ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã« OpenSSH ã‚’åŒæ™‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã‚‹ã®ã§ã€SSH ã‚µãƒ¼ãƒ“ã‚¹ã¯èµ·å‹•ã—ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚
```sh:Ubuntu Server bash
$ systemctl status sshd.service
â— ssh.service - OpenBSD Secure Shell server
     Loaded: loaded (/lib/systemd/system/ssh.service; enabled; vendor preset: enabled)
     Active: active (running)
     ...
```

`active (running)` ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°æœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚

### å…¬é–‹éµèªè¨¼ã®å°å…¥

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã®ãŸã‚ã€å…¬é–‹éµèªè¨¼ã‚’å°å…¥ã—ã¾ã™ã€‚

##### éµãƒšã‚¢ã®ä½œæˆ
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã® WSL ä¸Šã§éµãƒšã‚¢ã‚’ä½œæˆã—ã¾ã™ã€‚
ç¾çŠ¶ã§ã¯éµã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ `ed25519` ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚
```sh: WSL bash
$ ssh-keygen -t ed25519 -C ""
Generating public/private ed25519 key pair.
Enter file in which to save the key (/home/hoge/.ssh/id_ed25519):  # ä½•ã‚‚å…¥åŠ›ã›ãš Enter
Enter passphrase (empty for no passphrase):  # ä½•ã‚‚å…¥åŠ›ã›ãš Enter
Enter same passphrase again:  # ä½•ã‚‚å…¥åŠ›ã›ãš Enter
Your identification has been saved in /home/hoge/.ssh/id_ed25519
Your public key has been saved in /home/hoge/.ssh/id_ed25519.pub
The key fingerprint is:
SHA256:8rW9RFRliLuG5lL1fOnTyxKHEo1hMclYxTsT+GeRwbM
The key's randomart image is:
+--[ED25519 256]--+
|          ++*oo+=|
|         . *o+.* |
|          . *.o +|
|           +o* E |
|      . S .oo+* .|
|       o .+=oooo.|
|        .+..+ +..|
|        . .. o.o.|
|         .  . .oo|
+----[SHA256]-----+
```

ç§˜å¯†éµ `~/.ssh/id_ed25519`ã€å…¬é–‹éµ `~/.ssh/id_ed25519.pub` ã®éµãƒšã‚¢ãŒä½œæˆã•ã‚Œã¾ã—ãŸã€‚

##### å…¬é–‹éµã‚’ Ubuntu Server ã¸ã‚³ãƒ”ãƒ¼
ä½œæˆã—ãŸå…¬é–‹éµã‚’ WSL ã‹ã‚‰ Ubuntu Server ã¸ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚
```sh:WSL bash
$ ssh-copy-id -i .ssh/id_ed25519.pub hoge@192.168.1.10
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: ".ssh/id_ed25519.pub"
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
hoge@192.168.1.10's password:

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh 'hoge@192.168.1.10'"
and check to make sure that only the key(s) you wanted were added.
```

ã“ã‚Œã§ WSL ä¸Šã‹ã‚‰ç§˜å¯†éµã‚’ä½¿ã£ã¦ Ubuntu Server ã« SSH æ¥ç¶šã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
```sh:WSL bash
$ ssh -i .ssh/id_ed25519 hoge@192.168.1.10
Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0-72-generic x86_64)
```

### Windows ã‹ã‚‰ SSH æ¥ç¶š
Windows ã‹ã‚‰ã‚‚ Ubuntu Server ã¸ SSH æ¥ç¶šã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

##### ç§˜å¯†éµã‚’ç§»å‹•

WSL ä¸Šã®ç§˜å¯†éµ `~/.ssh/id_ed25519` ã‚’ Windows ã® `~/.ssh` ã«ç§»å‹•ã¾ãŸã¯ã‚³ãƒ”ãƒ¼ã—ã¦ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã®ãŸã‚ç¾ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ `System` ä»¥å¤–ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’å‰Šé™¤ã—ã¾ã™ã€‚
![](/images/2023-05-17-ed2221a065da3b-01.png)

ç¶šã‘ã¦ã€`~/.ssh/config` ã‚’ç·¨é›†ã—ã¦æ¥ç¶šè¨­å®šã‚’è¿½è¨˜ã—ã¾ã™ã€‚

```diff: Windows ~/.ssh/config
+Host ubuntu-server
+    HostName 192.168.1.10
+    IdentityFile ~/.ssh/id_ed25519
+    User hoge
```

##### SSH æ¥ç¶šç¢ºèª
ã“ã‚Œã§ Windows ä¸Šã‹ã‚‰ã‚‚ SSH æ¥ç¶šå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
```powershell:Windows cmd
> ssh ubuntu-server
Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0-72-generic x86_64)
```

### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã®ç„¡åŠ¹åŒ–
å…¬é–‹éµèªè¨¼ã§ SSH ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã®ãŸã‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã‚’ç„¡åŠ¹åŒ–ã—ã¾ã™ã€‚
`/etc/ssh/sshd_config.d/50-cloud-init.conf` ã‚’ç·¨é›†ã—ã¦ SSH ã®è¨­å®šã‚’å¤‰æ›´ã—ã¾ã™ã€‚

```diff:Ubuntu Server /etc/ssh/sshd_config.d/50-cloud-init.conf
+PasswordAuthentication no
+ChallengeResponseAuthentication no
+PermitRootLogin no
+PermitEmptyPasswords no
-PasswordAuthentication yes
```

å¤‰æ›´ã‚’æœ‰åŠ¹ã«ã™ã‚‹ãŸã‚ã« SSH ã‚µãƒ¼ãƒ“ã‚¹ã‚’å†èµ·å‹•ã—ã¾ã™ã€‚
```sh:Ubuntu Server bash
$ sudo systemctl restart sshd
```

ã“ã‚Œã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã¯ç„¡åŠ¹åŒ–ã•ã‚Œã¾ã—ãŸã€‚
```cmd:Windows cmd
> ssh hoge@192.168.1.10
hoge@192.168.1.10: Permission denied (publickey).
```

:::message alert
ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ãŒç„¡åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‹ã®ãƒã‚§ãƒƒã‚¯ã¯ç¢ºå®Ÿã«è¡Œã†ã“ã¨ã€‚
:::


### ãƒ­ã‚°è¨­å®š
`/etc/ssh/sshd_config.d/50-cloud-init.conf` ã‚’ç·¨é›†ã—ã¦ã€SSH ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã€‚
```diff:Ubuntu Server /etc/ssh/sshd_config.d/50-cloud-init.conf
+SyslogFacility AUTH
+LogLevel INFO
```


# ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã®è¨­å®š

### UFW ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
Minimal ã§ã¯ UFW ã¯åˆæœŸã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
```sh:Ubuntu Server bash
$ sudo apt install ufw
```

### ãƒãƒ¼ãƒˆé–‹æ”¾è¨­å®š
UFW ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹å‰ã« SSH ã®ãƒãƒ¼ãƒˆé–‹æ”¾ã‚’è¨­å®šã—ã¾ã™ã€‚
```sh:Ubuntu Server bash
$ sudo ufw allow ssh
Rules updated
Rules updated (v6)
```

### æœ‰åŠ¹åŒ–
UFW ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã™ã€‚
```sh:Ubuntu Server bash
$ sudo ufw enable
Command may disrupt existing ssh connections. Proceed with operation (y|n)? y
Firewall is active and enabled on system startup
```

### ãƒãƒ¼ãƒˆãƒã‚§ãƒƒã‚¯
WSL ã‹ã‚‰ nmap ã‚’ä½¿ç”¨ã—ã¦ã€ãƒãƒ¼ãƒˆé–‹æ”¾ãŒæƒ³å®šé€šã‚Šã‹ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚

##### TCP ã‚¹ã‚­ãƒ£ãƒ³
```sh:WSL bash
$ sudo nmap -sS 192.168.1.10
Starting Nmap 7.80 ( https://nmap.org ) at 2023-05-18 08:57 JST
Nmap scan report for 192.168.1.10
Host is up (0.0021s latency).
Not shown: 999 filtered ports
PORT   STATE SERVICE
22/tcp open  ssh

Nmap done: 1 IP address (1 host up) scanned in 6.04 seconds
```
`22/tcp open  ssh` ã¨ SSH ãƒãƒ¼ãƒˆã®ã¿é–‹æ”¾ã•ã‚Œã¦ã„ã¾ã™ã€‚

##### UDP ã‚¹ã‚­ãƒ£ãƒ³
```sh:WSL bash
$ sudo nmap -sU 192.168.1.10
Starting Nmap 7.80 ( https://nmap.org ) at 2023-05-18 08:47 JST
Nmap scan report for 192.168.1.10
Host is up (0.0012s latency).
All 1000 scanned ports on 192.168.1.10 are open|filtered

Nmap done: 1 IP address (1 host up) scanned in 22.43 seconds
```
å¿œç­”ãŒãªã‘ã‚Œã° `open|filtered` ã¨ã¿ãªã•ã‚Œã‚‹ã®ã§ã€é–‹æ”¾ãƒãƒ¼ãƒˆãŒãªã„ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

:::message alert
ãƒãƒ¼ãƒˆãƒã‚§ãƒƒã‚¯ã¯æ¼ã‚Œãªãè¡Œã†ã“ã¨ã€‚
:::

### ãƒ­ã‚°è¨­å®š
UFW ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã€‚
```sh:Ubuntu Server bash
$ sudo ufw logging medium
Logging enabled
```


# è‡ªå‹•ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®è¨­å®š
Ubuntu ã§ã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã¯é€šå¸¸ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã¨ç•°ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã§æä¾›ã•ã‚Œã¦ãŠã‚Šã€`unattended-upgrade` ã«ã‚ˆã‚Šè‡ªå‹•ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå‹•ä½œã—ã¦ã„ã¾ã™ã€‚

### è¨­å®šç¢ºèª
```sh:bash
$ cat /etc/apt/apt.conf.d/20auto-upgrades
APT::Periodic::Update-Package-Lists "1";  # apt update ã«ç›¸å½“
APT::Periodic::Unattended-Upgrade "1";    # apt upgrade ã«ç›¸å½“
```

### å‹•ä½œç¢ºèª
##### ã‚µãƒ¼ãƒ“ã‚¹ã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã¾ã™
```sh:bash
$ systemctl is-active unattended-upgrades.service
active
$ systemctl is-enabled unattended-upgrades.service
enabled
```

##### Systemd ã§ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™
```sh:bash
$ systemctl list-timers --all
NEXT                        LEFT     LAST                         PASSED       UNIT                     ACTIVATES
Thu 2023-05-18 06:30:14 UTC 6h left  Wed 2023-05-17 06:12:34 UTC  18h ago      apt-daily-upgrade.timer  apt-daily-upgrade.service
Thu 2023-05-18 08:47:41 UTC 8h left  Wed 2023-05-17 21:12:48 UTC  3h 6min ago  apt-daily.timer          apt-daily.service
```

##### ãƒ­ã‚°ã‹ã‚‰å‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™
```sh:bash
$ cat /var/log/apt/history.log
Start-Date: 2023-05-17  03:20:26
Commandline: /usr/bin/unattended-upgrades -v
Upgrade: tzdata:amd64 (2022g-0ubuntu0.22.04.1, 2023c-0ubuntu0.22.04.0)
End-Date: 2023-05-17  03:20:27
```

### è‡ªå‹•å†èµ·å‹•ã®è¨­å®š
ã‚µãƒ¼ãƒã«ã‚ˆã£ã¦ã¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆå¾Œã«è‡ªå‹•å†èµ·å‹•ã™ã‚‹ã‚ˆã†ãªè¨­å®šã‚’ã—ã¾ã™ã€‚

##### è¨­å®šè¿½åŠ 
`/etc/apt/apt.conf.d/50unattended-upgrades` ã‚’ç·¨é›†ã—ã¦è‡ªå‹•å†èµ·å‹•ã‚’è¨­å®šã—ã¾ã™ã€‚
```diff:Ubuntu Server /etc/apt/apt.conf.d/50unattended-upgrades
+Unattended-Upgrade::Automatic-Reboot "true";
-//Unattended-Upgrade::Automatic-Reboot "false";
+Unattended-Upgrade::Automatic-Reboot-Time "02:00";
-//Unattended-Upgrade::Automatic-Reboot-Time "02:00";
```

##### ã‚µãƒ¼ãƒ“ã‚¹å†èµ·å‹•
è¨­å®šã‚’æœ‰åŠ¹ã«ã™ã‚‹ãŸã‚ã«ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚’å†èµ·å‹•ã—ã¾ã™ã€‚
```sh:bash
$ sudo systemctl restart unattended-upgrades.service
```

# ãƒ­ã‚°ç®¡ç†
Rsyslog ã¨ Logrotate ã‚’ä½¿ç”¨ã—ã¦è‡ªå‹•ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€è‡ªå‹•å‰Šé™¤ãªã©ã®æ©Ÿèƒ½ã‚’å°å…¥ã—ã¾ã™ã€‚

### Rsyslog ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
Minimal ã§ã¯ Rsyslog ã¯åˆæœŸã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
```sh:bash
$ sudo apt install rsyslog
```
è¨­å®šã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å•é¡Œãªã„ã§ã—ã‚‡ã†ã€‚

### Logrotate ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
Minimal ã§ã¯ Logrotate ã¯åˆæœŸã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
```sh:bash
$ sudo apt install logrotate
```

### Logrotate ã®è¨­å®š
`/etc/logrotate.conf` ã‚’ç·¨é›†ã—ã¦è¨­å®šã‚’å¤‰æ›´ã—ã¾ã™ã€‚
```diff:Ubuntu Server /etc/logrotate.conf
+rotate 48    # ãƒ­ã‚°ä¿å­˜æœŸé–“ã‚’48é€±
-rotate 4
+dateext      # ãƒ•ã‚¡ã‚¤ãƒ«åã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã«YYYYMMDD
-dateext
+compress     # éåœ§ç¸®
-#compress
```

### ã‚µãƒ¼ãƒ“ã‚¹å†èµ·å‹•
Logrotate ã‚µãƒ¼ãƒ“ã‚¹ã‚’å†èµ·å‹•ã—ã¦ã€è¨­å®šã‚’åæ˜ ã•ã›ã¾ã™ã€‚
```sh:Ubuntu Server bash
$ sudo systemctl restart logrotate.service
```

### ãŠã‚ã‚Š
ä»¥ä¸Šã§ Ubuntu Server ã«æœ€ä½é™ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’åŠ ãˆãŸè¨­å®šã‚’çµ‚ãˆã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã«ã¯ã€ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ã¯ã‚‚ã¡ã‚ã‚“ã€ã©ã®ã‚ˆã†ãªã“ã¨ãŒèµ·ã“ã£ã¦ã„ãŸã‹ã®ãƒ­ã‚°ç®¡ç†ãŒã¨ã¦ã‚‚é‡è¦ã§ã™ã€‚
å®Ÿéš›ã®é‹ç”¨ã§ã¯ã“ã‚Œã‚‰ã‚’å¿œç”¨ã—ã¦ã„ãã“ã¨ã«ãªã‚Šã¾ã™ãŒã€ãã‚Œã¯ã¾ãŸåˆ¥ã®æ©Ÿä¼šã«ï¼

# ã”å‚è€ƒãƒ»è¬è¾
https://zenn.dev/uchidaryo/books/ubuntu-2204-server-book/
